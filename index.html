<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Programma LUI&LEI</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f2f2f2;
      color: #333;
      padding: 20px;
    }
    h2 {
      margin-top: 40px;
    }
    select {
      margin-right: 10px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
      background-color: #fff;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: center;
    }
    th {
      background-color: #0066cc;
      color: white;
    }
    .highlight {
      background-color: #d1e7dd !important;
    }
    .winner {
      font-weight: bold;
      color: green;
    }
  </style>
</head>
<body>
  <h1>Programma LUI&LEI - Fase a Gironi e Finali</h1>

  <div>
    <label for="campoFilter">Campo:</label>
    <select id="campoFilter"></select>
    <label for="giornoFilter">Giorno:</label>
    <select id="giornoFilter"></select>
    <label for="gironeFilter">Girone:</label>
    <select id="gironeFilter"></select>
  </div>

  <h2>Partite Fase a Gironi</h2>
  <table id="partiteTable"></table>

  <h2>Classifiche</h2>
  <div id="classificheContainer"></div>

  <h2>Fase Finale</h2>
  <table id="finaliTable"></table>

  <script>
    async function loadCSV(url) {
      const response = await fetch(url);
      const data = await response.text();
      const [headerLine, ...lines] = data.trim().split('\n');
      const headers = headerLine.split(',');
      return lines.map(line => {
        const values = line.split(',');
        const row = {};
        headers.forEach((h, i) => row[h.trim()] = values[i]?.trim() || '');
        return row;
      });
    }

    function createOptions(selectId, values) {
      const select = document.getElementById(selectId);
      select.innerHTML = '<option value="">Tutti</option>';
      Array.from(new Set(values)).sort().forEach(val => {
        const opt = document.createElement('option');
        opt.value = val;
        opt.textContent = val;
        select.appendChild(opt);
      });
    }

    function mostraFinali(data) {
      const container = document.getElementById("finaliTable");
      const rows = data.sort((a, b) => `${a.DATA} ${a.ORA}`.localeCompare(`${b.DATA} ${b.ORA}`))
        .map(row => {
          let squadra1 = row.SQUADRA1;
          let squadra2 = row.SQUADRA2;
          let risultato = row.RISULTATO || "-";
          let vincitore = null;

          if (risultato.includes("-")) {
            const [gol1, gol2] = risultato.split("-").map(n => parseInt(n));
            if (!isNaN(gol1) && !isNaN(gol2)) {
              if (gol1 > gol2) vincitore = "SQUADRA1";
              else if (gol2 > gol1) vincitore = "SQUADRA2";
            }
          }

          return `<tr>
            <td>${row.TURNO}</td>
            <td>${row.GIORNO}</td>
            <td>${row.DATA}</td>
            <td>${row.ORA}</td>
            <td>${row.CAMPO}</td>
            <td class="${vincitore === 'SQUADRA1' ? 'winner' : ''}">${squadra1}</td>
            <td class="${vincitore === 'SQUADRA2' ? 'winner' : ''}">${squadra2}</td>
            <td>${risultato}</td>
          </tr>`;
        }).join('');

      container.innerHTML = `<tr>
        <th>Turno</th><th>Giorno</th><th>Data</th><th>Ora</th><th>Campo</th>
        <th>Squadra 1</th><th>Squadra 2</th><th>Risultato</th>
      </tr>` + rows;
    }

    async function init() {
      const urlGironi = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSk6sFq6_ScnG6L8i3PNCO6CMfvxPZYvawGrvWqKq3riFp-2qxuDFozQOH1aUjsbeRglRjyFMbKAeGp/pub?gid=1898554956&single=true&output=csv';
      const urlFinali = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSk6sFq6_ScnG6L8i3PNCO6CMfvxPZYvawGrvWqKq3riFp-2qxuDFozQOH1aUjsbeRglRjyFMbKAeGp/pub?gid=660358441&single=true&output=csv';
      const gironi = await loadCSV(urlGironi);
      const finali = await loadCSV(urlFinali);

      // Chiamata a funzioni esistenti
      window.renderGironi(gironi);
      mostraFinali(finali);
    }

    window.addEventListener('DOMContentLoaded', init);
  </script>
  <script src="script-gironi.js"></script>
</body>
</html>
